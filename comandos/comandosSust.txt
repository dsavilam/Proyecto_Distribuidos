# ============================================================
# LOCALHOST – ENTREGA 2 (8 terminales)
# GA primario + GA backup + Actores + GC + PS
# ============================================================

# (solo 1ª vez, crear / resetear BD primaria y réplica)

cd ga
python init_db.py --db biblioteca.db
python init_db.py --db biblioteca_replica.db
cd ..

# ------------------------------------------------------------
# TERMINAL 1 — GA PRIMARIO
# ------------------------------------------------------------

python -m ga.ga --role primary --rep tcp://*:5570 --db ga/biblioteca.db --db-replica ga/biblioteca_replica.db

# ------------------------------------------------------------
# TERMINAL 2 — GA BACKUP
# ------------------------------------------------------------

python -m ga.ga --role backup --rep tcp://*:5571 --db ga/biblioteca_replica.db

# ------------------------------------------------------------
# TERMINAL 3 — Actor DEVOL (failover GA primario/backup)
# ------------------------------------------------------------

python -m actores.actor_devol --sub tcp://127.0.0.1:5560 --ga-primary tcp://127.0.0.1:5570 --ga-backup tcp://127.0.0.1:5571 --hc tcp://*:5601

# ------------------------------------------------------------
# TERMINAL 4 — Actor RENOV (failover GA primario/backup)
# ------------------------------------------------------------

python -m actores.actor_renov --sub tcp://127.0.0.1:5560 --ga-primary tcp://127.0.0.1:5570 --ga-backup tcp://127.0.0.1:5571 --hc tcp://*:5602

# ------------------------------------------------------------
# TERMINAL 5 — Actor PRESTAMO (síncrono, failover GA)
# ------------------------------------------------------------

python -m actores.actor_prestamo --bind tcp://*:5585 --ga-primary tcp://127.0.0.1:5570 --ga-backup tcp://127.0.0.1:5571 --hc tcp://*:5603

# ------------------------------------------------------------
# TERMINAL 6 — Gestor de Carga (GC)
# ------------------------------------------------------------

python -m gestor_carga.gc --rep tcp://*:5555 --pub tcp://*:5560 --hc-dev tcp://127.0.0.1:5601 --hc-ren tcp://127.0.0.1:5602 --prestamo-addr tcp://127.0.0.1:5585

# ------------------------------------------------------------
# TERMINAL 7 — PS Sede 1 (DEVOL/RENOV)
# ------------------------------------------------------------

python -m ps.ps --file ps/data/sol_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1

# ------------------------------------------------------------
# TERMINAL 8 — PS Sede 2 (DEVOL/RENOV)
# ------------------------------------------------------------

python -m ps.ps --file ps/data/sol_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1


# ============================================================
# LOCALHOST – EXPERIMENTOS PRESTAMO (usar archivos sol_prest_*)
# ============================================================
# Asumimos:
#   ps/data/sol_prest_sede1.txt  (≈30 PRESTAMO SEDE1)
#   ps/data/sol_prest_sede2.txt  (≈30 PRESTAMO SEDE2)
# Con TERMINALES 1–6 ya levantadas.

# ------------------------------------------------------------
# Escenario A – 4 PS por sede
# ------------------------------------------------------------

# SEDE1 (4 procesos PS en paralelo)
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS2
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS3
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS4

# SEDE2 (4 procesos PS en paralelo)
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS2
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS3
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS4

# ------------------------------------------------------------
# Escenario B – 6 PS por sede
# ------------------------------------------------------------

# SEDE1
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS2
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS3
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS4
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS5
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS6

# SEDE2
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS2
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS3
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS4
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS5
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS6

# ------------------------------------------------------------
# Escenario C – 10 PS por sede
# ------------------------------------------------------------

# SEDE1
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS2
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS3
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS4
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS5
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS6
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS7
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS8
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS9
python -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS10

# SEDE2
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS2
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS3
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS4
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS5
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS6
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS7
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS8
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS9
python -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS10


# ============================================================
# 4 VMs (4 máquinas en total)
# ============================================================

# Asignación de roles:

# VM1 (DANIEL)   = GA primario + GA backup
# VM2 (ANDRES)   = GC + PS + ACTOR-PREST
# VM3 (SANTIAGO) = Actor DEV (Devolución)
# VM4 (AMELIE)   = Actor REN (Renovación)

# IPs:

# VM1 (DANIEL)   10.43.101.229
# VM2 (ANDRES)   10.43.103.42
# VM3 (SANTIAGO) 10.43.102.163
# VM4 (AMELIE)   10.43.102.154

# Reemplaza si cambian las IPs.


# ------------------------------------------------------------
# VM1 — DANIEL – GA primario + GA backup
# ------------------------------------------------------------

cd PROYECTO_DISTRIBUIDOS
python3 ga/init_db.py --db ga/biblioteca.db
python3 ga/init_db.py --db ga/biblioteca_replica.db

python3 -m ga.ga --role primary --rep tcp://0.0.0.0:5570 --db ga/biblioteca.db --db-replica ga/biblioteca_replica.db

python3 -m ga.ga --role backup --rep tcp://0.0.0.0:5571 --db ga/biblioteca_replica.db


# ------------------------------------------------------------
# VM3 — SANTIAGO – Actor DEVOL
# ------------------------------------------------------------

cd PROYECTO_DISTRIBUIDOS
python3 -m actores.actor_devol --sub tcp://10.43.103.42:5560 --ga-primary tcp://10.43.101.229:5570 --ga-backup tcp://10.43.101.229:5571 --hc tcp://0.0.0.0:5601


# ------------------------------------------------------------
# VM4 — AMELIE – Actor RENOV
# ------------------------------------------------------------

cd PROYECTO_DISTRIBUIDOS
python3 -m actores.actor_renov --sub tcp://10.43.103.42:5560 --ga-primary tcp://10.43.101.229:5570 --ga-backup tcp://10.43.101.229:5571 --hc tcp://0.0.0.0:5602


# ------------------------------------------------------------
# VM2 — ANDRES – ACTOR-PREST + GC + PS
# ------------------------------------------------------------

cd PROYECTO_DISTRIBUIDOS

# Actor PRESTAMO (misma VM que GC)
python3 -m actores.actor_prestamo --bind tcp://0.0.0.0:5585 --ga-primary tcp://10.43.101.229:5570 --ga-backup tcp://10.43.101.229:5571 --hc tcp://0.0.0.0:5603

# Gestor de Carga (GC)
python3 -m gestor_carga.gc --rep tcp://0.0.0.0:5555 --pub tcp://0.0.0.0:5560 --hc-dev tcp://10.43.102.163:5601 --hc-ren tcp://10.43.102.154:5602 --prestamo-addr tcp://127.0.0.1:5585

# PS Sede 1 (DEVOL/RENOV)
python3 -m ps.ps --file ps/data/sol_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1

# PS Sede 2 (DEVOL/RENOV)
python3 -m ps.ps --file ps/data/sol_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1


# ------------------------------------------------------------
# VM2 — ANDRES – Experimentos PRESTAMO en 4 VMs
# (igual que en localhost pero usando python3)
# ------------------------------------------------------------

# Escenario A – 4 PS por sede

# SEDE1
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS2
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS3
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS4

# SEDE2
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS2
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS3
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS4

# Escenario B – 6 PS por sede

# SEDE1
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS2
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS3
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS4
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS5
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS6

# SEDE2
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS2
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS3
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS4
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS5
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS6

# Escenario C – 10 PS por sede

# SEDE1
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS1
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS2
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS3
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS4
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS5
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS6
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS7
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS8
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS9
python3 -m ps.ps --file ps/data/sol_prest_sede1.txt --endpoint tcp://127.0.0.1:5555 --label SEDE1-PS10

# SEDE2
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS1
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS2
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS3
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS4
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS5
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS6
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS7
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS8
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS9
python3 -m ps.ps --file ps/data/sol_prest_sede2.txt --endpoint tcp://127.0.0.1:5555 --label SEDE2-PS10


# ------------------------------------------------------------
# NOTAS FINALES
# ------------------------------------------------------------

# - Abrir puertos en las VMs: 5555 (GC-REP), 5560 (GC-PUB), 5570–5571 (GA-REP),
#   5585 (Actor PREST), 5601–5603 (health checks).
# - Orden recomendado de arranque: GA primario → GA backup → Actores → GC → PS.
# - En Windows, si el venv da problemas:
#       Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned -Force
#       .venv\Scripts\Activate.ps1
